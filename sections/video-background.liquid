{%- if section.settings.overlay_opacity == 10 -%}
  {%- assign overlay_class = 'bg-black/10' -%}
{%- elsif section.settings.overlay_opacity == 20 -%}
  {%- assign overlay_class = 'bg-black/20' -%}
{%- elsif section.settings.overlay_opacity == 30 -%}
  {%- assign overlay_class = 'bg-black/30' -%}
{%- elsif section.settings.overlay_opacity == 40 -%}
  {%- assign overlay_class = 'bg-black/40' -%}
{%- elsif section.settings.overlay_opacity == 50 -%}
  {%- assign overlay_class = 'bg-black/50' -%}
{%- elsif section.settings.overlay_opacity == 60 -%}
  {%- assign overlay_class = 'bg-black/60' -%}
{%- elsif section.settings.overlay_opacity == 70 -%}
  {%- assign overlay_class = 'bg-black/70' -%}
{%- elsif section.settings.overlay_opacity == 80 -%}
  {%- assign overlay_class = 'bg-black/80' -%}
{%- else -%}
  {%- assign overlay_class = 'bg-transparent' -%}
{%- endif -%}

{%- if section.settings.button_size == 'md' -%}
  {%- assign btn_size_class = 'px-8 h-12 rounded-md' -%}
{%- elsif section.settings.button_size == 'lg' -%}
  {%- assign btn_size_class = 'px-12 h-15 rounded-lg text-lg' -%}
{%- else -%}
  {%- assign btn_size_class = 'px-16 h-16 rounded-xl text-xl' -%}
{%- endif -%}

<div class="relative" data-section-id={{ section.id }}>
  {%- if section.settings.upload_video -%}
    <video
      class="w-full aspect-[3/4] md:aspect-[16/6] object-cover"
      loop
      autoplay
      preload="none"
      muted
      playsinline
      poster="{{ section.settings.cover_image | image_url: 'master' }}"
      data-src="{{ section.settings.upload_video | asset_url | escape }}"
    ></video>
  {%- else -%}
    <video
      class="w-full aspect-[3/4] md:aspect-[16/9] xl:aspect-[16/6] object-cover"
      loop
      autoplay
      preload="none"
      muted
      playsinline
      poster="{{ 'cover-image.png' | asset_url }}"
      data-src="https://assets.mixkit.co/videos/14776/14776-720.mp4"
    ></video>
  {%- endif -%}
  <div
    class="hero-overlay absolute top-0 right-0 bottom-0 left-0 z-1
      flex flex-col items-center justify-end {{ overlay_class }}"
  >
    <div class="w-full md:max-w-[700px] xl:max-w-[1000px] mx-auto pt-[20px] md:pt-[40px] pb-[30px] md:pb-[60px] px-4 text-center flex flex-col items-center" style="color: {{ section.settings.text_color }}">
      <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold !mb-4">{{ section.settings.heading }}</h2>
      <p class="text-base md:text-lg">{{ section.settings.description }}</p>
      {%- if section.settings.button_url != blank -%}
        <a
          href="{{ section.settings.button_url }}"
          {%- if section.settings.button_open_newtab == 'yes' -%}
            target="blank"
          {%- endif -%}
          class="flex w-max items-center justify-center !mt-6 md:!mt-8 bg-primary text-white
          {{ btn_size_class }} transition-all duration-200 hover:bg-secondary/60"
        >
          {{ section.settings.button_label }}
        </a>
      {%- endif -%}
    </div>
  </div>
</div>

<script>
  document.addEventListener('scroll', function () {
    const sectionEl = document.querySelector('[data-section-id={{ section.id | json }}]');
    if (sectionEl && (window.innerWidth >= 1180)) {
      lazyLoadVideo(sectionEl);
    }
  }, { once: true });

  window.addEventListener('shopify:section:load', function(event) {
    const sectionEl = event.target;
    if (sectionEl) {
      lazyLoadVideo(sectionEl);
    }
  });

  function lazyLoadVideo(sectionEl) {
    const videoEl = sectionEl.querySelector('video[data-src]');
    if (videoEl) {
      videoEl.src = videoEl.dataset.src;
      videoEl.load();
    }
  }
</script>

{% schema %}
{
  "name": "Video Background",
  "tag": "section",
  "settings": [
    {
      "type": "video",
      "id": "upload_video",
      "label": "Upload video",
    },
    {
      "type": "image_picker",
      "id": "cover_image",
      "label": "Cover Image"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Overlay Opacity",
      "min": 0,
      "max": 80,
      "default": 30,
      "step": 10,
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#ffffff",
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Title",
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Porta elementum a enim euismod quam justo lectus. Curabitur facilisi cubilia curae hac habitasse platea dictumst. Nisl malesuada lacinia integer nunc posuere ut hendrerit. Efficitur laoreet mauris pharetra vestibulum fusce dictum risus.",
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label",
      "default": "Button",
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "Button URL",
      "info": "Leave blank if you want to hide the button."
    },
    {
      "type": "select",
      "id": "button_open_newtab",
      "label": "Open Button URL in New Tab?",
      "options": [
        { "value": "yes", "label": "Yes" },
        { "value": "no", "label": "No" },
      ],
      "default": "no",
    },
    {
      "type": "select",
      "id": "button_size",
      "label": "Button Size",
      "options": [
        { "value": "md", "label": "M" },
        { "value": "lg", "label": "L" },
        { "value": "xl", "label": "XL" },
      ],
      "default": "lg",
    },
  ],
  "presets": [
    {
      "name": "Video Background",
      "category": "Main"
    }
  ]
}
{% endschema %}
